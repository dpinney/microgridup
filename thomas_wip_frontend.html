<!DOCTYPE html>
<html>
<head>
	<title>MicrogridUP &raquo; New</title>
	<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
	<script src="https://kit.fontawesome.com/92028f16c4.js" crossorigin="anonymous"></script>
	<style type="text/css">
		body {
			margin:0;
			padding:0;
			border:0;
			font-family:sans-serif;
		}
		h3 {
			margin-bottom:7px;
			margin-left: 5px;
		}
		.chunk, .desc {
			display: inline-block;
			background-color: lightgray;
			padding: 6px;
			border-radius: 4px;
			margin: 4px 2px 4px 2px;
		}
		#holder {
			width: 100%;
			margin-left: 4px;
		}
		button, input[type='submit'], label.fileButton {
			width:auto;
			padding: 9px;
			margin-right:3px;
			font-size:small;
			background:seagreen;
			-webkit-border-radius: 5px;
			-moz-border-radius: 5px;
			border-radius: 5px;
			border: none;
			color: white;
			cursor:pointer;
		}
		textarea {
			font-size: 12pt;
			margin-left: 5px;
			display: inline-block;
		}
		.advanced {
			display: inline-block;
			max-width: 50%;
			min-width: 500px;
		}
		.step {
		  max-width: 1000;
		  display: block;
		  margin: 0 auto;
		}
		.tooltip {
			border-bottom: 1px dotted #000000; 
			color: #000000;
			outline: none;
			cursor: help; 
			text-decoration: none;
			position: relative;
		}
		.tooltip span {
			margin-left: -999em;
			position: absolute;
			display: inline-block;
		}
		.tooltip:hover span {
			border-radius: 5px 5px; 
			-moz-border-radius: 5px; 
			-webkit-border-radius: 5px; 
			box-shadow: 5px 5px 5px rgba(0, 0, 0, 0.1); 
			-webkit-box-shadow: 5px 5px rgba(0, 0, 0, 0.1); 
			-moz-box-shadow: 5px 5px rgba(0, 0, 0, 0.1);
			font-family: Calibri, Tahoma, Geneva, sans-serif;
			position: absolute; 
			left: 0.5em; 
			top: 1.5em; 
			z-index: 99;
			margin-left: 0; 
			width: 200px;
		}
		.classic {
			background: #A9A9A9; 
			color: white; 
			padding: 5px 5px;
		}
		a {text-decoration: none; color: black;}
		a:hover {text-decoration: underline;}
		#image_id {
			max-width: 700px;
			padding: 10px;
		}
		.dropbtn {
		  color: white;
		  border: none;
		}
		.dropdown {
		  position: relative;
		  display: inline-block;
		}
		.dropdown-content {
		  display: none;
		  position: absolute;
		  background-color: #f1f1f1;
		  min-width: 160px;
		  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
		  z-index: 1;
		}
		.dropdown-content div {
		  color: black;
		  padding: 12px 16px;
		  text-decoration: none;
		  display: block;
		}
		.dropdown-content div:hover {background-color: #ddd; cursor: pointer;}
		.dropdown:hover .dropdown-content {display: block;}
		.dropdown:hover .dropbtn {background-color: #3e8e41;}
		.sub {
		    padding-left: 0px;
		}
		.feeder {
			padding-left: 10px;
		}
		.load, .solar, .battery, .wind, .diesel {
			padding-left: 20px;
		}
	</style>
</head>
<body>
	<div style="height:40px; width:100%; background:black; line-height:40px; padding-left:10px;">
		<p style="color:white; margin:0px"><a style="color:white; text-decoration:none" href="/"><b>MicrogridUP</b></a> &raquo; New</p>
	</div>
	<div id='stepOne' class='step'>
		<h3>Step 1: Select your technologies</h3>
		<div class="chunk">
			<label for="solar">Solar</label>
			<input type="checkbox" name="solar" id="solar" />
		</div>
		<div class="chunk">
			<label for="battery">Battery</label>
			<input type="checkbox" name="battery" id="battery" />
		</div>
		<div class="chunk">
			<label for="fossil">Fossil</label>
			<input type="checkbox" name="fossil" id="fossil" />
		</div>
		<div class="chunk">
			<label for="wind">Wind</label>
			<input type="checkbox" name="wind" id="wind" />
		</div>
	</div>

	<div id='stepTwo' class='step'>
		<h3>Step 2: Add a circuit</h3>
		<p>Please select your circuit creation method:</p>
		<input type="radio" id="upload" name="circuit" value="Upload" />
		<label for="upload">Upload circuit from file</label><br>
		<input type="radio" id="wizard" name="circuit" value="Creator" />
		<label for="wizard">Build circuit manually</label><br>

		<div id="circuitUpload" class="desc" style="margin-top:10px">
			{% if 'BASE_DSS' in in_data %}
			<div class="chunk">
				<label for="BASE_DSS_NAME">Circuit Definition (.dss)</label>
				<input type="text" name="BASE_DSS_NAME" value="{{in_data.BASE_DSS}}" readonly />
			</div>
			{% else %}
			<div class="chunk">
				<form id="upload-file" method="post" enctype="multipart/form-data">
				    <fieldset>
				        <label class="tooltip" for="file">Select a file<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				        <input name="file" type="file" />
				    </fieldset>
				    <fieldset>
				        <button id="upload-file-btn" type="button">Upload</button>
				    </fieldset>
				</form>
			</div>
			{% endif %}
		</div>

		<div id="circuitCreator" class="desc">
			<!-- Maybe let's make the magic happen here instead. -->
			<ul id="elements">
				<li class="sub" data-editable>Substation (click to rename)</li>
				<li class="feeder" data-editable>Feeder (click to rename)</li>
				<li class="load" data-editable>Load (click to rename)</li>
				<li class="solar" data-editable>Solar (click to rename)</li>
				<li class="battery" data-editable>Battery (click to rename)</li>
				<li class="diesel" data-editable>Diesel (click to rename)</li>
			</ul>
			<!-- <button id="newItem">Add new element</button> -->
			<div class="dropdown">
				<button class="dropbtn">Add element</button>
				<div class="dropdown-content">
					<div id="newSub" role="button" tabindex="0">Substation</div>
				    <div id="newFeeder" role="button" tabindex="0">Feeder</div>
				    <div id="newLoad" role="button" tabindex="0">Load</div>
				    <div id="newSolar" role="button" tabindex="0">Solar</div>
				    <div id="newWind" role="button" tabindex="0">Wind</div>
				    <div id="newBattery" role="button" tabindex="0">Battery</div>
				    <div id="newDiesel" role="button" tabindex="0">Diesel</div>
				</div>
			</div>
			<button id="backspace">Remove last element</button>
			<button id="toDss">Submit circuit</button>
		</div>

		<div id="critLoads">
	    </div>

	</div>

	<div id="partionPreviewer" class="step">
		<h3>Step 3: Partition into microgrids</h3>
		<div class="chunk">
			<label class="tooltip" for="MG_DEF_METHOD">Microgrid Definition Method<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
			<select id="partitionMethod" name="MG_DEF_METHOD" style="margin-right:6px">
				<option value="" disabled selected>Select method</option>
				<option value="manual" {% if in_data.MG_DEF_METHOD == 'manual' %}selected{% endif %}>Manual</option>
				<option value="lukes" {% if in_data.MG_DEF_METHOD == 'lukes' %}selected{% endif %}>Lukes</option>
				<option value="branch" {% if in_data.MG_DEF_METHOD == 'branch' %}selected{% endif %}>Branch</option>
				<option value="bottomUp" {% if in_data.MG_DEF_METHOD == 'bottom-up' %}selected{% endif %}>Bottom-Up</option>
				<option value="criticalLoads" {% if in_data.MG_DEF_METHOD == 'critical_loads' %}selected{% endif %}>Critical Loads</option>
			</select></br>
			<input id="previewPartitions" type="submit" value="Preview partitions" />
			<div id="partitionsPreview">
			</div>
			<form id="partitionManually" style="display: none;">
				<label for="mgQuantity">How many microgrids?</label>
				<input id="mgQuantity" type="text" autocomplete="off" placeholder="# of microgrids" />
				<button id="makeDropdowns" type="button">Go</button><br>
			</form>
			<div id="dropDowns" class="chunk" style="display: none;">
			</div>
		</div>
	</div>

	<div class="step">
		<h3>Step 4: Set technology parameters</h3>
		<div id="holder">
			<h5>Site and Utility</h5>
			<div class="chunk">
				<label class="tooltip" for="MODEL_DIR">Model Name<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="MODEL_DIR" value="{{in_data.MODEL_DIR}}" />
			</div>
			<div class="chunk">
				<label class="tooltip" for="latlon">Location<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="latlong" placeholder="Enter approx. latitude" />
				<input type="text" name="latlong" placeholder="Enter approx. longitude" />
			</div>
			<div>
				<i class="fa fa-plus-square"></i>
				<a href="javascript:void(0)" class="toggle show">Optional inputs</a>
				<div style="display:none">
					<div class="chunk">
						<label class="tooltip" for="energyCost">Energy Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="energyCost" value="0.12" />
					</div>
					<div class="chunk">
						<label class="tooltip" for="wholesaleCost">Wholesale Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="wholesaleCost" value="0.034" />
					</div>
				</div>		
			</div>
			<h5>Load Profile</h5>
			{% if 'LOAD_CSV' in in_data %}
			<div class="chunk">
				<label class="tooltip" for="LOAD_CSV_NAME">Load Data (.csv)<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="LOAD_CSV_NAME" value="{{in_data.LOAD_CSV}}" readonly />
			</div>
			{% else %}
			<div class="chunk">
				<label class="tooltip" for="LOAD_CSV">Load Data (.csv)<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="file" name="LOAD_CSV" />
			</div>
			{% endif %}
			<div class="chunk">
				<label class="tooltip" for="year">Year<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="year" value="2017" />
			</div>
			<div>
				<i class="fa fa-plus-square"></i>
				<a href="javascript:void(0)" class="toggle show">Optional inputs</a>
				<div style="display:none">
				</div>		
			</div>
			<h5>Resilience</h5>
			<div class="chunk">
				<label class="tooltip" for="FAULTED_LINE">Outage Location(s)<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="FAULTED_LINE" value="{{in_data.FAULTED_LINE}}" />
			</div>
			<div class="chunk">
				<label class="tooltip" for="outageDuration">Outage Duration<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="outageDuration" value="48" />
			</div>
			<div>
				<i class="fa fa-plus-square"></i>
				<a href="javascript:void(0)" class="toggle show">Optional inputs</a>
				<div style="display:none;">
					<div class="chunk">
						<label class="tooltip" for="QSTS_STEPS">Interconn. Time Steps<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="QSTS_STEPS" value="{{in_data.QSTS_STEPS}}" />
					</div>
					<div class="chunk">
						<label class="tooltip" for="DIESEL_SAFETY_FACTOR">Fossil Safety Margin (%)<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="DIESEL_SAFETY_FACTOR" value="{{in_data.DIESEL_SAFETY_FACTOR}}" />
					</div>
					<div class="chunk">
						<label class="tooltip" for="FOSSIL_BACKUP_PERCENT">Allowed Fossil (%)<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="FOSSIL_BACKUP_PERCENT" value="{{in_data.FOSSIL_BACKUP_PERCENT}}" />
					</div>
					<div class="chunk">
						<label class="tooltip" for="criticalLoadFactor">Critical Load Factor<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
						<input type="text" name="criticalLoadFactor" value="1" />
					</div>
				</div>
			</div>
			<h5>Financial</h5>
			<div class="chunk">
				<label class="tooltip" for="demandCost">Demand Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
				<input type="text" name="demandCost" value="20" />
			</div>
			<div class="chunk">
				<label class="tooltip" for="value_of_lost_load">Value of Lost Load<<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span>/label>
				<input type="text" name="value_of_lost_load" value="1" />
			</div>
			<div>
				<i class="fa fa-plus-square"></i>
				<a href="javascript:void(0)" class="toggle show">Optional inputs</a>
				<div style="display:none">
				</div>		
			</div>
			<div id="solarDiv" style="display:none">
				<h5>Solar</h5>
				<div class="chunk">
					<label class="tooltip" for="solarCanCurtail">Solar Can Curtail<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="checkbox" name="solarCanCurtail" value="true" checked />
				</div>
				<div class="chunk">
					<label class="tooltip" for="solarCanExport">Solar Can Export<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="checkbox" name="solarCanExport" value="true" checked />
				</div>
				<div class="chunk">
					<label class="tooltip" for="solarCost">Solar Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="solarCost" value="1600" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="solarExisting">Solar Existing<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="solarExisting" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="solarMax">Solar Max<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="solarMax" value="100000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="solarMin">Solar Min<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="solarMin" value="0" />
				</div>
			</div>
			<div id="batteryDiv" style="display:none">
				<h5>Battery</h5>
				<div class="chunk">
					<label class="tooltip" for="batteryCapacityCost">Battery Capacity Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryCapacityCost" value="420" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryCapacityMax">Battery Capacity Max<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryCapacityMax" value="1000000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryCapacityMin">Battery Capacity Min<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryCapacityMin" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryKwExisting">Battery kW Existing<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryKwExisting" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryKwhExisting">Battery kWh Existing<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryKwhExisting" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryPowerCost">Battery Power Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryPowerCost" value="840" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryPowerMax">Battery Power Max<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryPowerMax" value="1000000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="batteryPowerMin">Battery Power Min<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="batteryPowerMin" value="0" />
				</div>
			</div>
			<div id=fossilDiv style="display:none">
				<h5>Fossil</h5>
				<div class="chunk">
					<label class="tooltip" for="dieselGenCost">Diesel Gen Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="dieselGenCost" value="500" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="dieselMax">Diesel Max<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="dieselMax" value="1000000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="fuelAvailable">Fuel Available<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="fuelAvailable" value="50000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="genExisting">Gen Existing<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="genExisting" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="minGenLoading">Min Gen Loading<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="minGenLoading" value="0.3" />
				</div>
			</div>
			<div id="windDiv" style="display:none">
				<h5>Wind</h5>
				<div class="chunk">
					<label class="tooltip" for="windCost">Wind Cost<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="windCost" value="4989" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="windExisting">Wind Existing<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="windExisting" value="0" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="windMax">Wind Max<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="windMax" value="100000" />
				</div>
				<div class="chunk">
					<label class="tooltip" for="windMin">Wind Min<span class="classic">The threshold for how many seconds an outage lasts before it is considered a sustained outage.</span></label>
					<input type="text" name="windMin" value="0" />
				</div>
			</div>

			<br>
			<input type="submit" value="Run model" />
		</div>	
	</div>	

	<script type="text/javascript">
		var stepTwoComplete = false;

        // Enable technology checkboxes.
        $('[name="battery"]').change(function() {
            $('#batteryDiv').toggle(500);
        });
        $('[name="wind"]').change(function() {
            $('#windDiv').toggle(500);
        });
        $('[name="solar"]').change(function() {
            $('#solarDiv').toggle(500);
        });
        $('[name="fossil"]').change(function() {
            $('#fossilDiv').toggle(500);
        });

        // Enable circuit definition method choice.
        $(document).ready(function() {
        	$("div.desc").hide();
            $("input[name$='circuit']").click(function() {
                var test = $(this).val();

                $("div.desc").hide();
                $("#circuit" + test).show();
            });
        });

        // Editable text for circuit widget.
        $('body').on('click', '[data-editable]', function(){
        	var $og = $(this);
        	var $input = $('<input/>').val( $og.text() ).addClass( $og.attr("class") ).select();
        	$og.replaceWith( $input );
        	var save = function(){
        		var $p = $('<li data-editable />').text( $input.val() ).addClass( $og.attr("class") );
        		$input.replaceWith( $p );
        	};
        	$input.one('blur', save).focus();
        });

        // Remove last element in circuit widget.
        $("#circuitCreator").on('click', '#backspace', function () {
        	$('#elements li:last-child').remove();        	
        });

        // Add specific new elements to circuit widget.
        $('#newSub').on( "click", function() {
        	$("#elements").append('<li class="sub" data-editable>New substation (click to rename)</li>');
        }); 
        $('#newFeeder').on( "click", function() {
        	$("#elements").append('<li class="feeder" data-editable>New feeder (click to rename)</li>');
        }); 
        $('#newLoad').on( "click", function() {
        	$("#elements").append('<li class="load" data-editable>New load (click to rename)</li>');
        });
        $('#newSolar').on( "click", function() {
        	$("#elements").append('<li class="solar" data-editable>New solar (click to rename)</li>');
        }); 
        $('#newWind').on( "click", function() {
        	$("#elements").append('<li class="wind" data-editable>New wind (click to rename)</li>');
        });
        $('#newBattery').on( "click", function() {
        	$("#elements").append('<li class="battery" data-editable>New battery (click to rename)</li>');
        });
        $('#newDiesel').on( "click", function() {
        	$("#elements").append('<li class="diesel" data-editable>New diesel (click to rename)</li>');
        });

        // Create DSS from manually built circuit. Get loads.
        $(function() {
        	$('#toDss').click(function() {
        		// First, convert to list. Then, convert to JSON.
        		var list = [];
        		$('#elements li').each(function(idx, item){
        		    list.push({
        		        class: $(item).attr('class'),
        		        text: item.textContent
        		    });
        		});
        		json = JSON.stringify(list, null, "  ");
        		console.log(json)
        		// Next, make AJAX POST to backend. 
        		$.ajax({
        			url:'/jsonToDss',
        			type:'POST',
        			contentType:'application/json',
        			data:json,
        			success: function(data) {
        				stepTwoComplete = true;
        			    const loads = JSON.parse(data);
        			    $('#critLoads').empty();
        			    $('#critLoads').append('<p>Please select all critical loads:</p>')
        			    $('#dropDowns').empty();
        			    $('#dropDowns').hide();
        			    jQuery('<form>', {
        			        id: 'criticalLoadsSelect',
        			        class: 'chunk'
        			    }).appendTo('#critLoads');
        			    for (let i=0; i<loads.length; i++) {
        			    	$('#criticalLoadsSelect').append('<label><input type="checkbox">'+loads[i]+'</label>')
        			    	$('#dropDowns').append('<label><select></select> '+loads[i]+'</label><br>')
        			    }
        			    if (loads.length === 0) {
        			    	$('#criticalLoadsSelect').append('<p>No loads to select from.</p>')
        			    }
        			}
        		});
        	})
        })

        // Upload DSS circuit. Get loads.
        $(function() {
            $('#upload-file-btn').click(function() {
                var form_data = new FormData($('#upload-file')[0]);
                $.ajax({
                    type: 'POST',
                    url: '/uploadajax',
                    data: form_data,
                    contentType: false,
                    cache: false,
                    processData: false,
                    success: function(data) {
                    	stepTwoComplete = true;
                        const loads = JSON.parse(data);
                        $('#critLoads').empty();
                        $('#critLoads').append('<p>Please select all critical loads:</p>')
                        $('#dropDowns').empty();
                        $('#dropDowns').hide();
                        jQuery('<form>', {
                            id: 'criticalLoadsSelect',
                            class: 'chunk'
                        }).appendTo('#critLoads');
                        for (let i=0; i<loads.length; i++) {
                        	$('#criticalLoadsSelect').append('<label><input type="checkbox">'+loads[i]+'</label>')
                        	$('#dropDowns').append('<label><select></select> '+loads[i]+'</label><br>')
                        }
                        if (loads.length === 0) {
                        	$('#criticalLoadsSelect').append('<p>No loads to select from.</p>')
                        }
                    }
                });
            });
        });

        // Manual partitioning dynamic dropdown creation. 
        $('#makeDropdowns').on('click', function() {
        	if (stepTwoComplete === false) {
        		alert('Please complete step 2.')
        		return
        	}
        	if ($('#mgQuantity').val() === "") {
        		alert('Please input a number.')
        		return
        	}
        	$('#dropDowns label select').each(function() {
        		var numMgs = $('#mgQuantity').val();
        		for (let i = 0; i < numMgs; i++) {
        			var count = i + 1
        			$(this).append('<option value="">Mg' + count + '</option>');
        		}
        	});
        	$('#dropDowns').show();
        })

        // Hide/show manual partitioning div. 
        $('#partitionMethod').change(function() {
        	if ($(this).val() == 'manual') {
        	    $('#partitionManually').show();
        	    $('#previewPartitions').hide();
        	    $('#partitionsPreview').empty();
        	}
        	else { 
        		$('#partitionManually').hide();
        		$('#previewPartitions').show();
        	}
        })

	  	// Grab partitioning preview.
		$(function() {
	  		$('#previewPartitions').click(function() {
	  			if (stepTwoComplete === false) {
	  				alert('Please complete step 2.')
	  				return
	  			}
	  			// 1. Get critical loads, if any.
	  			critLoads = new Array();
	  			$('#criticalLoadsSelect label').each(function() {
	  				if ($(this).find('input')[0].checked) {
	  					var element = $(this).text();
	  					critLoads.push(element);
	  				}
	  			});
	  			console.log(critLoads);
	  			// 2. Get dss file name.
	  			var fileName = $('input[type=file]').val().split('\\').pop();
	  			if (fileName === '') {
	  				fileName = 'creation.dss'
	  			}
	  			if ($('#circuitCreator').is(':visible')){
	  				fileName = 'creation.dss'
	  			} // TODO: check to see if user has created this file.
	  			console.log(fileName);
	  			// 3. Get partitioning method.
	  			var method = $( "#partitionMethod option:selected" ).val();
	  			console.log(method);
	  			if (method === "") {
	  				alert('Please ensure you have chosen a partition method.');
	  				return
	  			}
	  			$.ajax({
	  		        url: 'previewPartitions',
	  		        type: 'POST',
	  		        data: {
	  		        	critLoads : JSON.stringify(critLoads),
	  		        	fileName : JSON.stringify(fileName),
	  		        	method : JSON.stringify(method)
	  		        },
	  		        success: function(data, status) {
	  		            /* creating image */
	  		            var img = $('<img id="image_id">');
	  		            img.attr('src', 'data:image/gif;base64,' + data);
	  		            $('#partitionsPreview').empty();
	  		            img.appendTo('#partitionsPreview'); 
	  		        }
	  			});
	  		});
		});

        // Show/hide optional inputs.
        $(function () {
            $('.toggle').click(function() {
                if ( $(this).hasClass('show') ) {
                    //replace the text
                    $(this).text('Show fewer inputs');
                    //replace the icon
                    $(this).prev('i').removeClass('fa-plus-square').addClass('fa-minus-square');
                    $(this).removeClass('show').addClass('hide');
                } else {
                    //replace the text
                    $(this).text('Optional inputs');
                    //replace the icon
                    $(this).prev('i').removeClass('fa-minus-square').addClass('fa-plus-square');
                    $(this).removeClass('hide').addClass('show');                
                }
                $(this).next('div').slideToggle('500');
            });
        });
    </script>
</body>
</html>